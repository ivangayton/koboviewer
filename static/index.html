<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" type="text/css" href="static/leaflet.css">
<style>
    body { margin: 0; font-family: helvetica; }
    #map { width: 100%; height: 100%; }
    #status {
      position: absolute;
      right: 0;
      top: 0;
      margin: 6px;
      padding: 6px;
      border: 1px solid #999;
      background: #fff;
      font-size: 14px;
      z-index: 1000;
    }
    #locate {
      position: absolute;
      right: 10px;
      bottom: 24px;
      width: 30px;
      height: 30px;
      background: #fff;
      border: 2px solid rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      z-index: 1000;
      -webkit-tap-highlight-color: rgba(51, 181, 229, 0.4);
    }
    #locate:hover { background: #f4f4f4; }
    #locate img { margin: 3px; }
</style>
<script src="static/jquery-3.2.1.min.js"></script>
<script src="static/leaflet.js"></script>
<script src="static/config.js"></script>
<script src="static/koboviewer.js"></script>

<div id="map"></div>
<div id="status"></div>
<div id="locate" onclick="map.locate({setView: true, maxZoom: 15})"><img src="static/locate-24.png"></div>

<script>
  function loadForm(form, callback) {
    var noun = (form.description.match(/drain_point/) ? 'points' :
                form.description.match(/drain_segment/) ? 'segments' :
                'records');
    setStatus('Loading ' + form.description +
              ' (' + form.num_of_submissions + ' ' + noun + ')...');
    syncRecords(form.formid, function() {
      showRecords(form.formid, map);
      setStatus(null);
      callback();
    });
  }

  var map = newOsmMap('map');
  map.setView(new L.LatLng(-6.764, 39.250), 14);  // Mikocheni
  setStatus('Loading forms...');
  syncForms(function() {
    var seg115 = forms[124];
    var seg114 = forms[119];
    var seg113 = forms[113];
    var seg112 = forms[104];
    var seg111 = forms[85];

    var pt115 = forms[123];
    var pt114 = forms[118];
    var pt113 = forms[114];
    var pt112 = forms[103];
    var pt111 = forms[84];

    loadForm(seg115, function() {
      loadForm(pt115, function() {
        loadForm(seg114, function() {
          loadForm(pt114, function() {
            loadForm(seg113, function() {
              loadForm(pt113, function() {
                loadForm(seg112, function() {
                  loadForm(pt112, function() {
                    loadForm(seg111, function() {
                      loadForm(pt111, function() {
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    });
  });
</script>
